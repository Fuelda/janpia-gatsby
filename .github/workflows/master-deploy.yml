name: Trigger Test (No Build/Deploy)

concurrency:
  group: "netlify-deploy"
  cancel-in-progress: true

on:
  push:
    branches:
      - master
  # repository_dispatch:
  #   types:
  #     - webhook
  schedule:
    - cron: "0 23 * * *"

jobs:
  debug-and-validate:
    runs-on: ubuntu-latest
    env:
      NODE_OPTIONS: "--max-old-space-size=4096"
    steps:
      - name: Debug Event Information
        run: |
          echo "=== Event Details ==="
          echo "Event Name: ${{ github.event_name }}"
          echo "Trigger Time: ${{ github.event.timestamp }}"
          echo "Action Type: ${{ github.event.action }}"
          echo "Repository: ${{ github.repository }}"


      - name: Cache dependencies
        uses: actions/cache@v3
        with:
          path: ~/.npm
          key: ${{ runner.OS }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.OS }}-node-

      - name: Install dependencies
        run: npm ci

      - name: Build Gatsby site
        run: npm run build
        env:
          GATSBY_EXPERIMENTAL_PAGE_BUILD_ON_DATA_CHANGES: true
          CI: true
          STRAPI_API_URL: ${{ secrets.STRAPI_API_URL }}
          STRAPI_TOKEN: ${{ secrets.STRAPI_TOKEN }}
          GATSBY_ALGOLIA_APP_ID: ${{ secrets.GATSBY_ALGOLIA_APP_ID }}
          GATSBY_ALGOLIA_SEARCH_KEY: ${{ secrets.GATSBY_ALGOLIA_SEARCH_KEY }}
          ALGOLIA_ADMIN_KEY: ${{ secrets.ALGOLIA_ADMIN_KEY }}
          GATSBY_TRACKING_ID: ${{ secrets.GATSBY_TRACKING_ID }}

      - name: Execution Timestamp
        run: |
          echo "Current Time: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
